### Часть 2. Реализация Rate-Limiting

Требуется разработать модуль для ограничения частоты запросов (rate-limiting) на основе алгоритма Token Bucket. Модуль должен защищать внутренние сервисы от перегрузок, обеспечивать честное распределение ресурсов между клиентами и корректно обрабатывать высокую нагрузку.

**Функциональные требования:**

**Реализация алгоритма Token Bucket:**

- Каждому клиенту (IP или API-ключ) выделяется отдельный **bucket** токенов.
- Настройки bucket: количество токенов (емкость), скорость пополнения.
- Запрос считается допустимым, если в bucket клиента есть токен. В противном случае — отклоняется.

**Гранулярное ограничение:**

- Отслеживать состояние каждого клиента (IP/API-ключ)
- Поддерживать возможность настройки разных лимитов для разных клиентов.
- Настройки для разных клиентов можно сохранять в базе данных

**Автоматическое пополнение токенов:**

- Использовать `time.Ticker` для периодического пополнения токенов в buckets.
- Гарантировать атомарность операций с токенами (проверка, извлечение, пополнение).

**Конкурентность:**

- Методы обработки запросов и обновления состояния buckets должны быть потокобезопасными.
- Обеспечить минимальные блокировки для максимизации производительности.

Требуется подготовить README с описанием сборки и запуска проекта.

### Будет здорово, если:

- Архитектура проекта будет модульной: разделите код на логически обособленные пакеты (например, для логики распределения, работы с конфигурацией и реализации HTTP-сервера).
- Приветствуется чистота кода, понятное и подробное комментирование, а также применение интерфейсов для упрощения замены реализаций.
- Оценка задания будет проводиться не только на основе реализованного функционала, но и на основе качества кода (структурирование, тестируемость, документация).
- Напишите Dockerfile и docker-compose.yml для развертывания сервиса и БД
- Добавите интеграционные тесты с использованием `go test -bench=. -race`.
- Пример нагрузки через Apache Bench (`ab -n 5000 -c 1000 http://localhost:8080/`).

### Дополнительные пункты для размышления

**Поддержка нескольких алгоритмов распределения:**

- Помимо round-robin, реализовать или предусмотреть возможность использования алгоритмов «least connections» или случайного распределения запросов.

**Здоровье бэкендов (Health Checks):**

- Добавить механизм периодических проверок состояния каждого бэкенд-сервера.
- При обнаружении недоступного сервера временно исключать его из пула, а при восстановлении работы возвращать обратно.

**Graceful Shutdown:**

- Реализовать корректное завершение работы балансировщика (обработка сигнала SIGINT или SIGTERM), чтобы завершить обработку текущих запросов без потери данных.

**CRUD для управления клиентами:**

- API для добавления/удаления клиентов (IP/API-ключей) и настройки их лимитов.
- Пример эндпоинта:
  `POST /clients { "client_id": "user1", "capacity": 100, "rate_per_sec": 10 }`

**Персистентность:**

- Сохранять состояние клиентов (текущие токены, настройки) в БД или файле.
- Использовать конфигурационный файл для дефолтных лимитов.

**Обработка ошибок:**

- Возвращать структурированные JSON-ошибки с кодом и описанием.
- Пример:
  `{ "code": 429, "message": "Rate limit exceeded" }`
